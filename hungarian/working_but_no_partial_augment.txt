
        def augment(visited, u):
            if u in visited:
                return False
            visited.add(u)
            for v, data in G[u].items():
                if potentials[u] + potentials[v] != data[weight]:
                    continue
                if v not in matching or augment(visited, matching[v]):
                    matching[v] = u
                    return True
            return False

        # find an unmatched left node
        for u in left_nodes:
            visited = set()
            if u not in matching and not augment(visited, u):
                break